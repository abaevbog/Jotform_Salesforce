<!DOCTYPE html>
<html>

<head>
    <script src="https://js.jotform.com/JotFormCustomWidget.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/jquery-ui.min.js"></script>
    <script scr="js/jquery.ui.autocomplete.scroll.min.js"></script>
    <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/themes/blitzer/jquery-ui.css"></link>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
* {
  box-sizing: border-box;
}

body {
  font: 16px Arial;  
}

/*the container must be positioned relative:*/
.autocomplete {
  position: relative;
  display: inline-block;
}

input {
  border: 1px solid transparent;
  background-color: #f1f1f1;
  padding: 10px;
  font-size: 16px;
}

input[type=text] {
  background-color: #f1f1f1;
  width: 100%;
}

input[type=submit] {
  background-color: DodgerBlue;
  color: #fff;
  cursor: pointer;
}




.ui-autocomplete {
    max-height: 100px;
    overflow-y: auto;
    /* prevent horizontal scrollbar */
    overflow-x: hidden;
    /* add padding to account for vertical scrollbar */
    padding-right: 20px;
} 

</style>
</head>     
<body>

<h2>Autocomplete</h2>

<p>Start typing:</p>

<!--Make sure the form has the autocomplete function switched off:-->

  <div class="autocomplete" style="width:300px;">
    <input id="myInput" type="text" name="myCountry" placeholder="Name or Email">
    <input id="myVerif" type="text" name="myCountry" placeholder="Verification token">
  </div>
  <button id="askSalesforce"> Ask Salesforce</button>
  <button id="found" hidden=true>I selected the lead</button>
  <div id="loading" hidden=true>LOADING ... </div>
  <div id ="emailSubmit" hidden = true>Email: </div>


  
<script>
$(document).ready(function(){
    JFCustomWidget.subscribe("submit", function(){
        var msg = {
            valid: true,
            value: document.getElementById('emailSubmit').innerHTML
        }
        // send value to JotForm
        JFCustomWidget.sendSubmit(msg);
    });
});



document.getElementById('found').addEventListener('click', function(e){
  var listOfWords = document.getElementById('myInput').value.split(' ');
  for(var i =0; i<listOfWords.length;i++){
    if(listOfWords[i].includes('@')){
      document.getElementById('emailSubmit').innerHTML = listOfWords[i];
      document.getElementById('emailSubmit').hidden = false;
    }
  }
});

function makeOptions(records){
  var options = [];
  if (records.length == 0){
    alert("Nothing was found");
  }
  for(var i = 0; i < records.length; i++){
    var client = records[i];
    console.log(client);
    var suggestion = client["Name"]+' ' +client["Phone"]+' '+client["Email"]+'\n '+client["Address"]["street"]+','+client["Address"]["city"]+','+client["Address"]["state"]+','+client["Address"]["postalCode"];
    options.push(suggestion);
  } 
  $('#myInput').autocomplete({
    minLength:2,
    maxShowItems: 2,
    source: options
  });

  document.getElementById('loading').hidden=true;
  document.getElementById('found').hidden=false;
  document.getElementById('myInput').value = '';
}

document.getElementById('askSalesforce').addEventListener('click',function() {
    var inpt = document.getElementById('myInput').value;
    var verif = document.getElementById('myVerif').value;
    document.getElementById('loading').innerHTML = "Loading...";
    document.getElementById('loading').hidden=false;

           $.ajax({
                url:"https://f1091oc0g4.execute-api.us-east-1.amazonaws.com/first/pashabd",
                method:'POST',
                data: JSON.stringify({'Value': inpt, "Verif": verif}),
                success: function(result){
                    var records = JSON.parse(result)['records'];
                    if (records){
                      makeOptions(JSON.parse(result)['records']);
                    } else {
                      document.getElementById('emailSubmit').innerHTML = "No authorization";
                      document.getElementById('emailSubmit').hidden = false;
                    }
                },
                error: function(res){
                    document.getElementById('loading').innerHTML = "No authorization";
                }
            }
            )
    })

</script>

</body>

</html>



